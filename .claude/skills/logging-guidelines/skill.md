---
name: logging-guidelines
description: Sagebaseã®ãƒ­ã‚®ãƒ³ã‚°è¦ç´„ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã€‚printæ–‡ç¦æ­¢ã€loggerã®ä½¿ç”¨åŸºæº–ã€ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®ä½¿ã„åˆ†ã‘ã‚’ã‚«ãƒãƒ¼ã€‚ãƒ­ã‚°å‡ºåŠ›ã‚’è¿½åŠ ãƒ»ä¿®æ­£ã™ã‚‹æ™‚ã€ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãæ™‚ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆã—ã¾ã™ã€‚
---

# Logging Guidelinesï¼ˆãƒ­ã‚®ãƒ³ã‚°è¦ç´„ï¼‰

## ç›®çš„
Sagebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãŠã‘ã‚‹ãƒ­ã‚®ãƒ³ã‚°ã®ä¸€è²«æ€§ã¨å“è³ªã‚’ç¢ºä¿ã™ã‚‹ãŸã‚ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’æä¾›ã—ã¾ã™ã€‚DEBUGç”¨ã®printæ–‡ã®æ··å…¥ã‚’é˜²ãã€é©åˆ‡ãªloggerã®ä½¿ç”¨ã‚’ä¿ƒé€²ã—ã¾ã™ã€‚

## ã„ã¤ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆã™ã‚‹ã‹
ã“ã®ã‚¹ã‚­ãƒ«ã¯ä»¥ä¸‹ã®å ´åˆã«è‡ªå‹•çš„ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆã•ã‚Œã¾ã™ï¼š
- ãƒ­ã‚°å‡ºåŠ›ã‚’è¿½åŠ ãƒ»ä¿®æ­£ã™ã‚‹æ™‚
- ãƒ‡ãƒãƒƒã‚°ç”¨ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãæ™‚
- æ–°ã—ã„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹æ™‚ï¼ˆloggerã®åˆæœŸåŒ–ï¼‰
- `print(` ã‚’ã‚³ãƒ¼ãƒ‰ã«è¿½åŠ ã—ã‚ˆã†ã¨ã™ã‚‹æ™‚
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å®Ÿè£…ã™ã‚‹æ™‚

## ã‚¯ã‚¤ãƒƒã‚¯ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ã‚³ãƒ¼ãƒ‰è¿½åŠ å‰
- [ ] **printæ–‡ã‚’ä½¿ç”¨ã—ã¦ã„ãªã„**ï¼ˆçµ¶å¯¾ç¦æ­¢ï¼‰
- [ ] **é©åˆ‡ãªãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’é¸æŠã—ã¦ã„ã‚‹**
- [ ] **loggerãŒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹**

### ã‚³ãƒ¼ãƒ‰è¿½åŠ ä¸­
- [ ] **ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ˜ç¢ºã§æœ‰ç”¨**
- [ ] **æ©Ÿå¯†æƒ…å ±ã‚’ãƒ­ã‚°ã«å«ã‚ã¦ã„ãªã„**
- [ ] **æ—¢å­˜ã®loggerå‡ºåŠ›ã¨é‡è¤‡ã—ã¦ã„ãªã„**

### ãƒ‡ãƒãƒƒã‚°æ™‚
- [ ] **ä¸€æ™‚çš„ãªprintæ–‡ã‚’è¿½åŠ ã—ã¦ã„ãªã„**
- [ ] **logger.debugã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹**

---

## ğŸš« çµ¶å¯¾ç¦æ­¢: printæ–‡ã®ä½¿ç”¨

**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ã§printæ–‡ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã¯çµ¶å¯¾ã«ç¦æ­¢ã§ã™**

### ç¦æ­¢ã•ã‚Œã‚‹ç†ç”±

1. **ãƒ­ã‚°ç®¡ç†ã®ä¸€è²«æ€§ãŒå¤±ã‚ã‚Œã‚‹**
   - ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«åˆ¶å¾¡ãŒã§ããªã„
   - ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®å¯¾è±¡å¤–
   - æ§‹é€ åŒ–ãƒ­ã‚°ã®æ©æµã‚’å—ã‘ã‚‰ã‚Œãªã„

2. **æœ¬ç•ªç’°å¢ƒã§ã®å•é¡Œ**
   - æ¨™æº–å‡ºåŠ›ã¸ã®ä¸è¦ãªå‡ºåŠ›
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ãƒ„ãƒ¼ãƒ«ã¨ã®éäº’æ›
   - Sentryç­‰ã®ã‚¨ãƒ©ãƒ¼è¿½è·¡ãŒæ©Ÿèƒ½ã—ãªã„

3. **ãƒ‡ãƒãƒƒã‚°ã®å›°é›£ã•**
   - å‡ºåŠ›å…ƒã®ç‰¹å®šãŒå›°é›£
   - ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãŒãªã„
   - ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ãŒãªã„

### âŒ æ‚ªã„ä¾‹

```python
# âŒ DEBUGç”¨ã®print
print(f"DEBUG: Processing {len(items)} items")

# âŒ é€²æ—è¡¨ç¤ºã®print
print(f"Processing {i}/{total}...")

# âŒ ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã®print
print(f"Error: {e}")

# âŒ è­¦å‘Šã®print
print(f"è­¦å‘Š: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
```

### âœ… è‰¯ã„ä¾‹

```python
# âœ… DEBUGç”¨ã®ãƒ­ã‚°
logger.debug(f"Processing {len(items)} items")

# âœ… é€²æ—è¡¨ç¤ºã®ãƒ­ã‚°
logger.info(f"Processing {i}/{total}...")

# âœ… ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã®ãƒ­ã‚°
logger.error(f"Error: {e}")

# âœ… è­¦å‘Šã®ãƒ­ã‚°
logger.warning("ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
```

---

## ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®ä½¿ã„åˆ†ã‘

### DEBUG
**ç”¨é€”**: é–‹ç™ºæ™‚ã®ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã€è©³ç´°ãªå†…éƒ¨çŠ¶æ…‹

```python
# å¤‰æ•°ã®å€¤ã‚’ç¢ºèª
logger.debug(f"Sample links = {sample_urls}")

# å‡¦ç†ã®è©³ç´°ã‚¹ãƒ†ãƒƒãƒ—
logger.debug(f"After filtering - child_links={len(child_links)}")

# å†…éƒ¨çŠ¶æ…‹ã®ãƒˆãƒ¬ãƒ¼ã‚¹
logger.debug(f"size_in_bytes: {size_in_bytes}")
```

**ç‰¹å¾´**:
- æœ¬ç•ªç’°å¢ƒã§ã¯é€šå¸¸å‡ºåŠ›ã•ã‚Œãªã„
- é–‹ç™ºè€…å‘ã‘ã®è©³ç´°æƒ…å ±
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«å½±éŸ¿ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹å¤§é‡å‡ºåŠ›OK

### INFO
**ç”¨é€”**: æ­£å¸¸ãªå‡¦ç†ã®é€²æ—ã€é‡è¦ãªã‚¤ãƒ™ãƒ³ãƒˆ

```python
# å‡¦ç†ã®é–‹å§‹ãƒ»å®Œäº†
logger.info(f"Analyzing links for URL: {input_dto.current_url}")

# å‡¦ç†çµæœã®ã‚µãƒãƒªãƒ¼
logger.info(f"Extracted {len(all_links)} total links")

# é‡è¦ãªçŠ¶æ…‹å¤‰åŒ–
logger.info("LLMãƒ™ãƒ¼ã‚¹ã®æ­£è¦åŒ–ã‚’ä½¿ç”¨")
```

**ç‰¹å¾´**:
- æœ¬ç•ªç’°å¢ƒã§ã‚‚å‡ºåŠ›ã•ã‚Œã‚‹
- å‡¦ç†ã®æµã‚Œã‚’è¿½è·¡å¯èƒ½
- é©åº¦ãªé »åº¦ã§å‡ºåŠ›

### WARNING
**ç”¨é€”**: äºˆæœŸã›ã¬çŠ¶æ³ã ãŒå‡¦ç†ã¯ç¶™ç¶šå¯èƒ½

```python
# ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚‰ãªã„
logger.warning(f"ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ '{keyword}' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚")

# ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
logger.warning("LLMæ­£è¦åŒ–å¤±æ•—ã€ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ç”¨", error=str(e))

# è¨­å®šã®å•é¡Œ
logger.warning("API key not set, using default configuration")
```

**ç‰¹å¾´**:
- å•é¡Œã®å…†å€™ã‚’ç¤ºã™
- å³åº§ã®å¯¾å¿œã¯ä¸è¦ã ãŒæ³¨æ„ãŒå¿…è¦
- ç›£è¦–å¯¾è±¡ã¨ã™ã¹ã

### ERROR
**ç”¨é€”**: ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸãŒã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ç¶™ç¶šå¯èƒ½

```python
# å‡¦ç†ã®å¤±æ•—
logger.error(f"Failed to save data: {e}")

# å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¨ãƒ©ãƒ¼
logger.error(f"API call failed: {response.status_code}")

# ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
logger.error(f"Invalid input: {validation_errors}")
```

**ç‰¹å¾´**:
- å•é¡Œã®ç™ºç”Ÿã‚’ç¤ºã™
- èª¿æŸ»ãŒå¿…è¦
- Sentryã«è‡ªå‹•é€ä¿¡ã•ã‚Œã‚‹

### CRITICAL
**ç”¨é€”**: è‡´å‘½çš„ãªã‚¨ãƒ©ãƒ¼ã€ã‚·ã‚¹ãƒ†ãƒ ãŒæ©Ÿèƒ½ä¸èƒ½

```python
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šå¤±æ•—
logger.critical("Database connection failed, shutting down")

# å¿…é ˆè¨­å®šã®æ¬ è½
logger.critical("Required API key not configured")
```

**ç‰¹å¾´**:
- å³åº§ã®å¯¾å¿œãŒå¿…è¦
- ã‚¢ãƒ©ãƒ¼ãƒˆç™ºå ±
- ç¨€ã«ã—ã‹ä½¿ç”¨ã—ãªã„

---

## loggerã®åˆæœŸåŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³

### æ¨™æº–ãƒ‘ã‚¿ãƒ¼ãƒ³

```python
"""ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®èª¬æ˜."""

import logging

# ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ¬ãƒ™ãƒ«ã§loggerã‚’å®šç¾©
logger = logging.getLogger(__name__)


class MyService:
    """ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¹."""

    def process(self) -> None:
        """å‡¦ç†ã‚’å®Ÿè¡Œ."""
        logger.info("Processing started")
        # ...
        logger.debug(f"Processed {count} items")
```

### é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ

1. **`__name__`ã‚’ä½¿ç”¨ã™ã‚‹**
   ```python
   # âœ… è‰¯ã„ä¾‹
   logger = logging.getLogger(__name__)

   # âŒ æ‚ªã„ä¾‹
   logger = logging.getLogger("my_module")  # ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰
   logger = logging.getLogger()  # ãƒ«ãƒ¼ãƒˆãƒ­ã‚¬ãƒ¼
   ```

2. **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ¬ãƒ™ãƒ«ã§å®šç¾©ã™ã‚‹**
   ```python
   # âœ… è‰¯ã„ä¾‹ï¼šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ¬ãƒ™ãƒ«
   logger = logging.getLogger(__name__)

   class MyClass:
       pass

   # âŒ æ‚ªã„ä¾‹ï¼šã‚¯ãƒ©ã‚¹å†…ã§å®šç¾©
   class MyClass:
       logger = logging.getLogger(__name__)
   ```

3. **importæ–‡ã®å¾Œã€ã‚¯ãƒ©ã‚¹å®šç¾©ã®å‰ã«é…ç½®**
   ```python
   """Docstring."""

   import logging
   from typing import Any

   from src.domain.entities import Entity

   logger = logging.getLogger(__name__)  # ã“ã“ã«é…ç½®


   class MyService:
       pass
   ```

---

## æ§‹é€ åŒ–ãƒ­ã‚°ã®æ´»ç”¨

Sagebaseã§ã¯`structlog`ã‚’ä½¿ç”¨ã—ãŸæ§‹é€ åŒ–ãƒ­ã‚°ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚

### ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å¼•æ•°ã§ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ 

```python
# âœ… è‰¯ã„ä¾‹ï¼šæ§‹é€ åŒ–ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
logger.info(
    "Processing completed",
    item_count=len(items),
    duration_ms=elapsed_time,
    status="success"
)

# âŒ æ‚ªã„ä¾‹ï¼šf-stringã§å…¨ã¦åŸ‹ã‚è¾¼ã¿
logger.info(f"Processing completed: {len(items)} items in {elapsed_time}ms, status=success")
```

### ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®ä½¿ç”¨

```python
from src.common.logging import LogContext

# ãƒªã‚¯ã‚¨ã‚¹ãƒˆå…¨ä½“ã§ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å…±æœ‰
with LogContext(request_id=request_id, user_id=user_id):
    logger.info("Processing request")
    # ã“ã®ãƒ–ãƒ­ãƒƒã‚¯å†…ã®ãƒ­ã‚°ã«request_idã¨user_idãŒè‡ªå‹•çš„ã«å«ã¾ã‚Œã‚‹
```

---

## ã‚ˆãã‚ã‚‹ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³

### 1. logger.infoã¨é‡è¤‡ã™ã‚‹print

```python
# âŒ æ‚ªã„ä¾‹ï¼šé‡è¤‡å‡ºåŠ›
logger.info(f"Extracted {len(all_links)} total links")
print(f"DEBUG: Extracted {len(all_links)} total links")  # é‡è¤‡ï¼

# âœ… è‰¯ã„ä¾‹ï¼šloggerã®ã¿
logger.info(f"Extracted {len(all_links)} total links")
```

### 2. çµµæ–‡å­—ã‚’ãƒ­ã‚°ã«å«ã‚ã‚‹

```python
# âŒ æ‚ªã„ä¾‹ï¼šçµµæ–‡å­—
print(f"â• æ–°è¦è¿½åŠ : {name}")  # ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ ã¨ã®äº’æ›æ€§å•é¡Œ

# âœ… è‰¯ã„ä¾‹ï¼šãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
logger.debug(f"æ–°è¦è¿½åŠ : {name}")
```

### 3. æ©Ÿå¯†æƒ…å ±ã®ãƒ­ã‚°å‡ºåŠ›

```python
# âŒ æ‚ªã„ä¾‹ï¼šæ©Ÿå¯†æƒ…å ±
logger.info(f"User logged in with password: {password}")
logger.debug(f"API key: {api_key}")

# âœ… è‰¯ã„ä¾‹ï¼šæ©Ÿå¯†æƒ…å ±ã‚’ãƒã‚¹ã‚¯
logger.info(f"User logged in: {username}")
logger.debug("API key configured: ***")
```

### 4. éå‰°ãªãƒ­ã‚°å‡ºåŠ›

```python
# âŒ æ‚ªã„ä¾‹ï¼šãƒ«ãƒ¼ãƒ—å†…ã§æ¯å›ãƒ­ã‚°
for item in items:  # 10000ä»¶
    logger.info(f"Processing item: {item}")

# âœ… è‰¯ã„ä¾‹ï¼šã‚µãƒãƒªãƒ¼ã®ã¿
logger.info(f"Processing {len(items)} items")
for item in items:
    # å‡¦ç†
    pass
logger.info("Processing completed")
```

---

## ãƒ‡ãƒãƒƒã‚°æ™‚ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### ä¸€æ™‚çš„ãªãƒ‡ãƒãƒƒã‚°å‡ºåŠ›

```python
# âŒ çµ¶å¯¾ç¦æ­¢ï¼šprintæ–‡
print(f"DEBUG: value = {value}")

# âœ… æ¨å¥¨ï¼šlogger.debug
logger.debug(f"value = {value}")
```

### ãƒ‡ãƒãƒƒã‚°å¾Œã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

ãƒ‡ãƒãƒƒã‚°ãŒå®Œäº†ã—ãŸã‚‰ï¼š
1. ä¸è¦ãª`logger.debug`ã‚’å‰Šé™¤
2. æ®‹ã™ã¹ããƒ­ã‚°ã¯é©åˆ‡ãªãƒ¬ãƒ™ãƒ«ã«å¤‰æ›´
3. ã‚³ãƒŸãƒƒãƒˆå‰ã«`print`ã®æ®‹ç•™ã‚’ãƒã‚§ãƒƒã‚¯

```bash
# printæ–‡ã®æ®‹ç•™ãƒã‚§ãƒƒã‚¯
grep -rn "print(" src/ | grep -v "docstring\|#"
```

---

## é–¢é€£ã‚¹ã‚­ãƒ«

- [project-conventions](../project-conventions/): ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®è¦ç´„
- [test-writer](../test-writer/): ãƒ†ã‚¹ãƒˆä½œæˆã‚¬ã‚¤ãƒ‰

---

## ã¾ã¨ã‚

### é‡è¦ãªåŸå‰‡

âœ… **printæ–‡ã¯çµ¶å¯¾ã«ä½¿ç”¨ã—ãªã„**
âœ… **logger.getLogger(__name__)ã§loggerã‚’åˆæœŸåŒ–**
âœ… **é©åˆ‡ãªãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’é¸æŠ**
âœ… **æ§‹é€ åŒ–ãƒ­ã‚°ã§ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ **
âœ… **æ©Ÿå¯†æƒ…å ±ã‚’ãƒ­ã‚°ã«å«ã‚ãªã„**

**ã“ã‚Œã‚‰ã®åŸå‰‡ã«å¾“ã†ã“ã¨ã§ã€ä¸€è²«æ€§ãŒã‚ã‚Šã€é‹ç”¨ã—ã‚„ã™ã„ãƒ­ã‚®ãƒ³ã‚°ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚**
